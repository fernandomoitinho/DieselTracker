<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Diesel Tracker</title>
    
    <!-- iOS Web App Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Diesel Tracker">
    <meta name="theme-color" content="#047857">

    <!-- App Icon (Embedded Base64 SVG) -->
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjojMDQ3ODU3Ij48cmVjdCB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgcng9IjAiIGZpbGw9IiMwNDc4NTciLz48cGF0aCBkPSJNMzY4IDEyOEgxNDRjLTE3LjY3IDAtMzIgMTQuMzMtMzIgMzJ2MjU2YzAgMTcuNjcgMTQuMzMgMzIgMzIgMzJoMjI0YzE3LjY3IDAgMzItMTQuMzMgMzItMzJWMTYwYzAtMTcuNjctMTQuMzMtMzItMzItMzJ6IiBmaWxsPSIjZmZmIi8+PHBhdGggZD0iTTE0NCAxNjBoMjI0djk2SDE0NHoiIGZpbGw9IiMzNGQzOTkiLz48cGF0aCBkPSJNMjMyIDMyMGg0OHY0OGgtNDh6IiBmaWxsPSIjMDQ3ODU3Ii8+PHBhdGggZD0iTTM2OCAxMjhoMzJjMTcuNjcgMCAzMiAxNC4zMyAzMiAzMnYxMjhjMCAxNy42Ny0xNC4zMyAzMi0zMiAzMmgtMzIiIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2ZmZiIgc3Ryb2tlLXdpZHRoPSIyNCIvPjwvc3ZnPg==">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48cmVjdCB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgcng9IjEyMCIgZmlsbD0iIzA0Nzg1NyIvPjxwYXRoIGQ9Ik0zNjggMTI4SDE0NGMtMTcuNjcgMC0zMiAxNC4zMy0zMiAzMnYyNTZjMCAxNy42NyAxNC4zMyAzMiAzMiAzMmgyMjRjMTcuNjcgMCAzMi0xNC4zMyAzMi0zMlYxNjBjMC0xNy42Ny0xNC4zMy0zMi0zMi0zMnoiIGZpbGw9IiNmZmYiLz48cGF0aCBkPSJNMTQ0IDE2MGgyMjR2OTZIMTQ0eiIgZmlsbD0iIzM0ZDM5OSIvPjxwYXRoIGQ9Ik0yMzIgMzIwaDQ4djQ4aC00OHoiIGZpbGw9IiMwNDc4NTciLz48cGF0aCBkPSJNMzY4IDEyOGgzMmMxNy42NyAwIDMyIDE0LjMzIDMyIDMydjEyOGMwIDE3LjY3LTE0LjMzIDMyLTMyIDMyaC0zMiIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjZmZmIiBzdHJva2Utd2lkdGg9IjI0Ii8+PC9zdmc+">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React & ReactDOM (Pinned Versions) -->
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    
    <!-- Prop-Types (Required for Recharts UMD) -->
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
    
    <!-- Recharts (Stable UMD Version) -->
    <script src="https://unpkg.com/recharts@2.5.0/umd/Recharts.js"></script>

    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* iOS Safe Area Support */
        body {
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
        }
        /* Disable pull-to-refresh to feel more like an app */
        body {
            overscroll-behavior-y: none;
        }
        .pb-safe {
            padding-bottom: env(safe-area-inset-bottom);
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 font-sans min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;
        const { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Legend } = Recharts;

        // --- Icons ---
        const Icons = {
            Fuel: () => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-full h-full"><line x1="3" x2="15" y1="22" y2="22"/><line x1="4" x2="14" y1="9" y2="9"/><path d="M14 22V4a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v18"/><path d="M14 13h2a2 2 0 0 1 2 2v2a2 2 0 0 0 2 2h0a2 2 0 0 0 2-2V9.83a2 2 0 0 0-.59-1.42L18 5"/></svg>,
            Plus: () => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-full h-full"><path d="M5 12h14"/><path d="M12 5v14"/></svg>,
            Edit: () => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-full h-full"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>,
            Trash2: () => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-full h-full"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>,
            TrendingUp: () => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-full h-full"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>,
            Droplet: () => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-full h-full"><path d="M12 22a7 7 0 0 0 7-7c0-2-2-3-2-3L12 2 7 12s-2 1-2 3a7 7 0 0 0 7 7z"/></svg>,
            Euro: () => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-full h-full"><path d="M4 10h12"/><path d="M4 14h9"/><path d="M19 6a7.7 7.7 0 0 0-5.2-2A7.9 7.9 0 0 0 6 12c0 4.4 3.5 8 7.8 8 2 0 3.8-.8 5.2-2"/></svg>,
            Calendar: () => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-full h-full"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>,
            History: () => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-full h-full"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M12 7v5l4 2"/></svg>,
            Download: () => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-full h-full"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>,
            Upload: () => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-full h-full"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>,
            Database: () => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-full h-full"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s 9-1.34 9-3V5"/></svg>,
            X: () => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-full h-full"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
        };

        // --- Data Management (Local Storage) ---
        const STORAGE_KEY = 'diesel_tracker_data_v1';

        const getStoredLogs = () => {
            try {
                const stored = localStorage.getItem(STORAGE_KEY);
                return stored ? JSON.parse(stored) : [];
            } catch (e) {
                console.error("Error reading storage", e);
                return [];
            }
        };

        const saveLogsToStorage = (newLogs) => {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(newLogs));
            } catch (e) {
                console.error("Error saving storage", e);
                alert("Storage full! Please clear some space.");
            }
        };

        // --- Helpers ---
        const toInputDate = (dateObj) => {
            const year = dateObj.getFullYear();
            const month = String(dateObj.getMonth() + 1).padStart(2, '0');
            const day = String(dateObj.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        };

        // --- Components ---

        function FuelTracker() {
            const [logs, setLogs] = useState([]);
            const [loading, setLoading] = useState(true);
            
            // Form State
            const [pricePerLiter, setPricePerLiter] = useState('');
            const [totalCost, setTotalCost] = useState('');
            const [liters, setLiters] = useState('');
            const [dateInput, setDateInput] = useState(toInputDate(new Date())); 
            const [editingId, setEditingId] = useState(null);
            
            const [viewMode, setViewMode] = useState('cost');
            const fileInputRef = useRef(null);

            // Initial Load
            useEffect(() => {
                const data = getStoredLogs();
                data.sort((a, b) => new Date(b.date) - new Date(a.date));
                setLogs(data);
                setLoading(false);
            }, []);

            // Auto-calculate logic
            useEffect(() => {
                const p = parseFloat(pricePerLiter);
                const c = parseFloat(totalCost);
                if (!isNaN(p) && !isNaN(c) && p > 0) {
                    setLiters((c / p).toFixed(2));
                }
            }, [pricePerLiter, totalCost]);

            // Safe numeric input handler for iOS comma issue
            const handleNumericInput = (setter) => (e) => {
                let value = e.target.value;
                // Replace comma with dot
                value = value.replace(/,/g, '.');
                // Validate float pattern (allow empty, numbers, single dot)
                if (value === '' || /^\d*\.?\d*$/.test(value)) {
                    setter(value);
                }
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                
                const p = parseFloat(pricePerLiter);
                const c = parseFloat(totalCost);
                const l = parseFloat(liters);

                if (!p || !c || !l) return;

                const inputDateParts = dateInput.split('-');
                const entryDate = new Date(
                    parseInt(inputDateParts[0]), 
                    parseInt(inputDateParts[1]) - 1, 
                    parseInt(inputDateParts[2]), 
                    12, 0, 0
                );

                const entryData = {
                    id: editingId || Date.now().toString(),
                    date: entryDate.toISOString(),
                    pricePerLiter: p,
                    totalCost: c,
                    liters: l
                };

                let updatedLogs;
                if (editingId) {
                    updatedLogs = logs.map(log => log.id === editingId ? entryData : log);
                } else {
                    updatedLogs = [entryData, ...logs];
                }

                updatedLogs.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                setLogs(updatedLogs);
                saveLogsToStorage(updatedLogs);

                if (navigator.vibrate) navigator.vibrate(50);
                resetForm();
            };

            const resetForm = () => {
                setPricePerLiter('');
                setTotalCost('');
                setLiters('');
                setDateInput(toInputDate(new Date()));
                setEditingId(null);
            };

            const handleEdit = (log) => {
                setPricePerLiter(String(log.pricePerLiter));
                setTotalCost(String(log.totalCost));
                setLiters(String(log.liters));
                
                const logDate = new Date(log.date);
                setDateInput(toInputDate(logDate));
                
                setEditingId(log.id);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            const handleDelete = (id) => {
                if (!confirm('Delete this entry?')) return;
                const updatedLogs = logs.filter(log => log.id !== id);
                setLogs(updatedLogs);
                saveLogsToStorage(updatedLogs);
                
                if (id === editingId) {
                    resetForm();
                }
            };

            // --- Export / Import Logic ---
            const handleExport = () => {
                const dataStr = JSON.stringify(logs, null, 2);
                const blob = new Blob([dataStr], { type: "application/json" });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `diesel_backup_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            const handleImportClick = () => {
                fileInputRef.current?.click();
            };

            const handleFileChange = (event) => {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        if (Array.isArray(importedData)) {
                            if (importedData.length > 0 && (!importedData[0].totalCost || !importedData[0].date)) {
                                alert("Invalid format: JSON does not look like fuel logs.");
                                return;
                            }

                            if (confirm(`Found ${importedData.length} entries. This will OVERWRITE your current data. Continue?`)) {
                                setLogs(importedData);
                                saveLogsToStorage(importedData);
                                alert("Data imported successfully!");
                            }
                        } else {
                            alert("Invalid JSON format (expected an array).");
                        }
                    } catch (err) {
                        console.error(err);
                        alert("Error parsing JSON file.");
                    }
                    event.target.value = '';
                };
                reader.readAsText(file);
            };

            const chartData = useMemo(() => {
                const now = new Date();
                const displayData = []; 
                
                for (let i = 11; i >= 0; i--) {
                    const d = new Date(now.getFullYear(), now.getMonth() - i, 1);
                    const year = d.getFullYear();
                    const month = d.getMonth();
                    
                    displayData.push({
                        label: d.toLocaleDateString('pt-PT', { month: 'short' }), 
                        fullLabel: d.toLocaleDateString('pt-PT', { month: 'short', year: '2-digit' }),
                        year: year,
                        month: month,
                        cost: 0,
                        liters: 0,
                        prevCost: 0,
                        prevLiters: 0,
                        key: `${year}-${month}`,
                        prevKey: `${year - 1}-${month}`
                    });
                }

                logs.forEach(log => {
                    const d = new Date(log.date);
                    const logKey = `${d.getFullYear()}-${d.getMonth()}`;
                    
                    const currentSlot = displayData.find(slot => slot.key === logKey);
                    if (currentSlot) {
                        currentSlot.cost += log.totalCost;
                        currentSlot.liters += log.liters;
                    }

                    const prevSlot = displayData.find(slot => slot.prevKey === logKey);
                    if (prevSlot) {
                        prevSlot.prevCost += log.totalCost;
                        prevSlot.prevLiters += log.liters;
                    }
                });

                return displayData;
            }, [logs]);

            const currentYearTotal = useMemo(() => {
                const currentYear = new Date().getFullYear();
                return logs
                    .filter(l => new Date(l.date).getFullYear() === currentYear)
                    .reduce((acc, curr) => acc + curr.totalCost, 0);
            }, [logs]);

            const formatCurrency = (val) => new Intl.NumberFormat('pt-PT', { style: 'currency', currency: 'EUR' }).format(val);
            const formatDate = (dateString) => new Intl.DateTimeFormat('pt-PT', { day: '2-digit', month: 'short', year: 'numeric' }).format(new Date(dateString));

            if (loading) {
                return (
                    <div className="flex items-center justify-center min-h-screen">
                        <div className="flex flex-col items-center animate-pulse">
                            <div className="w-12 h-12 text-emerald-600 mb-4"><Icons.Fuel /></div>
                            <p>Loading Garage...</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="pb-safe">
                    <header className="sticky top-0 z-50 bg-emerald-700 text-white p-4 shadow-lg pt-safe-top">
                        <div className="max-w-4xl mx-auto flex items-center justify-between">
                            <div className="flex items-center gap-3">
                                <div className="bg-white/20 p-2 rounded-lg text-white">
                                    <div className="w-5 h-5"><Icons.Fuel /></div>
                                </div>
                                <div>
                                    <h1 className="text-lg font-bold leading-tight">Diesel Tracker</h1>
                                    <p className="text-emerald-100 text-xs">FIRE Edition</p>
                                </div>
                            </div>
                            <div className="text-right">
                                <p className="text-emerald-100 text-[10px] uppercase tracking-wider">YTD Spending</p>
                                <p className="text-xl font-bold leading-none">{formatCurrency(currentYearTotal)}</p>
                            </div>
                        </div>
                    </header>

                    <main className="max-w-4xl mx-auto p-4 space-y-6">
                        {/* Input Form */}
                        <section className={`bg-white rounded-xl shadow-sm p-5 border transition-colors ${editingId ? 'border-amber-400 bg-amber-50/30' : 'border-slate-100'}`}>
                            <h2 className={`text-sm uppercase tracking-wide font-bold mb-4 flex items-center gap-2 ${editingId ? 'text-amber-600' : 'text-slate-500'}`}>
                                {editingId ? (
                                    <>
                                        <div className="w-4 h-4"><Icons.Edit /></div>
                                        Editing Entry
                                    </>
                                ) : (
                                    <>
                                        <div className="w-4 h-4 text-emerald-600"><Icons.Plus /></div>
                                        Register Fill
                                    </>
                                )}
                            </h2>
                            <form onSubmit={handleSubmit} className="grid grid-cols-1 md:grid-cols-4 gap-4">
                                <div className="space-y-1 md:col-span-4 min-w-0">
                                    <label className="text-xs font-medium text-slate-500 uppercase">Date</label>
                                    <div className="relative">
                                        <div className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"><Icons.Calendar /></div>
                                        <input 
                                            type="date" 
                                            className="w-full min-w-0 max-w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-emerald-500 outline-none text-base font-medium text-slate-700 appearance-none" 
                                            value={dateInput} 
                                            onChange={(e) => setDateInput(e.target.value)} 
                                            required 
                                        />
                                    </div>
                                </div>

                                <div className="space-y-1 md:col-span-2">
                                    <label className="text-xs font-medium text-slate-500 uppercase">Price / Liter</label>
                                    <div className="relative">
                                        <div className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"><Icons.Euro /></div>
                                        <input 
                                            type="text" 
                                            inputMode="decimal" 
                                            placeholder="1.659" 
                                            className="w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-emerald-500 outline-none text-base font-medium" 
                                            value={pricePerLiter} 
                                            onChange={handleNumericInput(setPricePerLiter)} 
                                            required 
                                        />
                                    </div>
                                </div>
                                <div className="space-y-1 md:col-span-2">
                                    <label className="text-xs font-medium text-slate-500 uppercase">Total Paid</label>
                                    <div className="relative">
                                        <div className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"><Icons.Euro /></div>
                                        <input 
                                            type="text" 
                                            inputMode="decimal" 
                                            placeholder="50.00" 
                                            className="w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-emerald-500 outline-none text-base font-medium" 
                                            value={totalCost} 
                                            onChange={handleNumericInput(setTotalCost)} 
                                            required 
                                        />
                                    </div>
                                </div>
                                <div className="space-y-1 md:col-span-4">
                                    <label className="text-xs font-medium text-slate-500 uppercase">Volume</label>
                                    <div className="relative">
                                        <div className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"><Icons.Droplet /></div>
                                        <input type="number" step="0.01" placeholder="Calc..." className="w-full pl-10 pr-4 py-3 bg-slate-100 border border-slate-200 rounded-xl text-slate-500 outline-none text-base" value={liters} onChange={(e) => setLiters(e.target.value)} readOnly />
                                    </div>
                                </div>
                                
                                <div className="md:col-span-4 pt-2 flex gap-2">
                                    {editingId && (
                                        <button type="button" onClick={resetForm} className="w-1/3 bg-slate-200 active:bg-slate-300 text-slate-700 py-3.5 rounded-xl font-bold shadow-sm transition-all flex items-center justify-center gap-2 touch-manipulation">
                                            <div className="w-5 h-5"><Icons.X /></div>
                                            Cancel
                                        </button>
                                    )}
                                    <button type="submit" className={`flex-1 ${editingId ? 'bg-amber-600 active:bg-amber-700' : 'bg-emerald-600 active:bg-emerald-700'} active:scale-[0.98] text-white py-3.5 rounded-xl font-bold shadow-sm transition-all flex items-center justify-center gap-2 touch-manipulation`}>
                                        <div className="w-5 h-5">{editingId ? <Icons.Edit /> : <Icons.Plus />}</div>
                                        {editingId ? 'Update Entry' : 'Add Entry'}
                                    </button>
                                </div>
                            </form>
                        </section>

                        {/* Chart */}
                        <section className="bg-white rounded-xl shadow-sm p-5 border border-slate-100">
                             <div className="flex items-center justify-between mb-4">
                                <h2 className="text-sm uppercase tracking-wide text-slate-500 font-bold flex items-center gap-2">
                                    <div className="w-4 h-4 text-emerald-600"><Icons.TrendingUp /></div>
                                    Trends (YoY)
                                </h2>
                                <div className="flex bg-slate-100 p-1 rounded-lg">
                                    <button onClick={() => setViewMode('cost')} className={`px-3 py-1 text-xs font-bold rounded-md transition-all ${viewMode === 'cost' ? 'bg-white shadow text-emerald-700' : 'text-slate-500'}`}>EUR</button>
                                    <button onClick={() => setViewMode('liters')} className={`px-3 py-1 text-xs font-bold rounded-md transition-all ${viewMode === 'liters' ? 'bg-white shadow text-emerald-700' : 'text-slate-500'}`}>LITERS</button>
                                </div>
                            </div>
                            <div className="h-[250px] w-full">
                                <ResponsiveContainer width="100%" height="100%">
                                    <BarChart data={chartData} margin={{ top: 10, right: 0, left: -20, bottom: 0 }}>
                                        <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#f1f5f9" />
                                        <XAxis dataKey="label" axisLine={false} tickLine={false} tick={{ fontSize: 10, fill: '#94a3b8' }} dy={10} />
                                        <YAxis axisLine={false} tickLine={false} tick={{ fontSize: 10, fill: '#94a3b8' }} />
                                        <Tooltip 
                                            cursor={{ fill: '#f8fafc' }} 
                                            contentStyle={{ borderRadius: '12px', border: 'none', boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)' }} 
                                        />
                                        <Legend 
                                            verticalAlign="top" 
                                            height={36} 
                                            iconType="circle"
                                            iconSize={8}
                                            wrapperStyle={{ fontSize: '12px', color: '#64748b' }}
                                        />
                                        
                                        <Bar dataKey={viewMode === 'cost' ? 'prevCost' : 'prevLiters'} name="Last Year" fill="#cbd5e1" radius={[4, 4, 0, 0]} />
                                        <Bar dataKey={viewMode === 'cost' ? 'cost' : 'liters'} name="Current" fill={viewMode === 'cost' ? '#10b981' : '#3b82f6'} radius={[4, 4, 0, 0]} />
                                    </BarChart>
                                </ResponsiveContainer>
                            </div>
                        </section>

                        {/* History */}
                        <section className="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
                             <div className="p-5 border-b border-slate-100 bg-slate-50/50">
                                <h2 className="text-sm uppercase tracking-wide text-slate-500 font-bold flex items-center gap-2">
                                    <div className="w-4 h-4 text-emerald-600"><Icons.History /></div>
                                    History
                                </h2>
                            </div>
                            <div className="divide-y divide-slate-100">
                                {logs.length === 0 ? (
                                    <div className="p-8 text-center text-slate-400 text-sm">No entries yet.</div>
                                ) : (
                                    logs.map((log) => (
                                        <div key={log.id} className="p-4 flex items-center justify-between hover:bg-slate-50 transition-colors">
                                            <div className="flex flex-col gap-1">
                                                <span className="text-xs font-bold text-slate-400 flex items-center gap-1">
                                                    <div className="w-3 h-3"><Icons.Calendar /></div>
                                                    {formatDate(log.date)}
                                                </span>
                                                <span className="font-medium text-slate-700">
                                                    {log.liters.toFixed(2)} L <span className="text-slate-300 mx-1">@</span> {log.pricePerLiter.toFixed(3)}
                                                </span>
                                            </div>
                                            <div className="flex items-center gap-3">
                                                <span className="text-lg font-bold text-emerald-600 mr-2">{formatCurrency(log.totalCost)}</span>
                                                
                                                <button onClick={() => handleEdit(log)} className="text-slate-300 hover:text-amber-500 p-2 active:scale-90 transition-all bg-slate-50 rounded-lg">
                                                    <div className="w-4 h-4"><Icons.Edit /></div>
                                                </button>
                                                
                                                <button onClick={() => handleDelete(log.id)} className="text-slate-300 hover:text-red-500 p-2 active:scale-90 transition-all bg-slate-50 rounded-lg">
                                                    <div className="w-4 h-4"><Icons.Trash2 /></div>
                                                </button>
                                            </div>
                                        </div>
                                    ))
                                )}
                            </div>
                        </section>

                        {/* Data Management Section */}
                        <section className="bg-slate-100 rounded-xl p-5 border border-slate-200 mb-8">
                             <div className="flex items-center justify-between mb-4">
                                <h2 className="text-sm uppercase tracking-wide text-slate-500 font-bold flex items-center gap-2">
                                    <div className="w-4 h-4 text-emerald-600"><Icons.Database /></div>
                                    Data Backup
                                </h2>
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <button onClick={handleExport} className="flex items-center justify-center gap-2 bg-white hover:bg-slate-50 text-slate-700 py-3 rounded-xl border border-slate-300 font-medium transition-colors text-sm">
                                    <div className="w-4 h-4"><Icons.Download /></div>
                                    Export JSON
                                </button>
                                <button onClick={handleImportClick} className="flex items-center justify-center gap-2 bg-white hover:bg-slate-50 text-slate-700 py-3 rounded-xl border border-slate-300 font-medium transition-colors text-sm">
                                    <div className="w-4 h-4"><Icons.Upload /></div>
                                    Import JSON
                                </button>
                                <input type="file" ref={fileInputRef} onChange={handleFileChange} accept=".json" className="hidden" />
                            </div>
                            <p className="text-xs text-slate-400 mt-3 text-center">Export your data before switching phones. Import to restore.</p>
                        </section>

                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<FuelTracker />);
    </script>
</body>
</html>